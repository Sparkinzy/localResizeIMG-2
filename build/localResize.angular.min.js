/**
  @Name     ：localResize.angular for angular
  @version  : 2.0.0
  @Date     ：Wed Oct 29 2014 11:17:47 GMT+0800 (中国标准时间)
  @Blog     ：think2011.github.io
  @Author   ：think2011
  @Copyright：think2011
**/ 
(function(){var e,t;t=function(){var e;return e=document.scripts[document.scripts.length-1],e.src.substr(0,e.src.lastIndexOf("/"))}(),e=function(){function e(e){this.el=e.el,this.options=e.defaults,this.source=e,this._init(this.el)}return e.prototype.reset=function(){return this.el.classList.remove("waiting"),this.el.classList.remove("success"),this.el.classList.remove("only-read"),this.el.classList.add("ready"),this.el.querySelector(".lr-img").style.backgroundImage=null},e.prototype.setWait=function(){return this.el.classList.remove("ready"),this.el.classList.remove("success"),this.el.classList.remove("only-read"),this.el.classList.add("waiting")},e.prototype.setImgOnly=function(e){return this.el.classList.remove("ready"),this.el.classList.remove("waiting"),this.el.classList.remove("success"),this.el.classList.add("only-read"),this.el.querySelector(".lr-img").style.backgroundImage="url("+e+")"},e.prototype.setImg=function(e){return this.setSuccess(),this.el.querySelector(".lr-img").style.backgroundImage="url("+e+")"},e.prototype.setSuccess=function(){return this.el.classList.remove("ready"),this.el.classList.remove("waiting"),this.el.classList.remove("only-read"),this.el.classList.add("success")},e.prototype.setTitle=function(e){return e=e||this.el.dataset.title,e?this.el.querySelector(".lr-title").innerHTML=e:this.el.classList.add("no-title")},e.prototype._addEl=function(){var e;return e='<div class="lr-title"></div>\n\n<div class="lr-hint">\n    <div class="lr-ready">\n        <i class="fa fa-camera"></i>\n        <p>点击上传</p>\n    </div>\n\n    <div class="lr-waiting">\n        <i class="fa fa-spinner fa-spin"></i>\n    </div>\n</div>\n\n<div class="lr-success">\n    <div class="lr-remove">\n        <i class="fa fa-trash"></i>\n    </div>\n\n    <div class="lr-img"></div>\n</div>',this.el.classList.add("lr"),this.el.classList.add("lr-ui"),this.el.innerHTML=e,this.reset()},e.prototype._onRemove=function(){return this.el.querySelector(".lr-remove").addEventListener("click",function(e){return function(){return e.source.reset()}}(this),!1)},e.prototype._initStyle=function(){var s;return s=document.createElement("link"),s.type="text/css",s.rel="stylesheet",s.href=""+t+"/localResize.css",document.head.appendChild(s),e.prototype._initStyle=function(){return!0}},e.prototype._init=function(){return this._initStyle(),this._addEl(),this._onRemove(),this.setTitle()},e}(),window.LrUI=e}).call(this);
(function(){var t;t=function(){function t(t,e){var n,i;if(null==e&&(e={}),!t)return console.error("需要传入一个dom元素");this.el=t,this.results={},this.defaults={rWidth:800,quality:.7,UI:!0};for(n in e)i=e[n],i&&(this.defaults[n]=i);this._init()}return t.prototype.setImg=function(t){return this.UI.setImg(t),this},t.prototype.setImgOnly=function(t){return this.UI.setImgOnly(t),this},t.prototype.setStop=function(){return this.UI.setSuccess(),this},t.prototype.reset=function(){return this.results={},this.UI.reset(),this},t.prototype.change=function(t){return"function"==typeof t&&(this.change=t),this},t.prototype.success=function(t){return"function"==typeof t&&(this.success=t),this},t.prototype._initStyle=function(){var e,n;return e=".lr {\n  position: relative;\n  display: inline-block;\n}\n\n.lr input[type=file] {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 1991;\n    opacity: 0;\n}",n=document.createElement("style"),n.innerHTML=e,document.head.appendChild(n),t.prototype._initStyle=function(){return!0}},t.prototype._createEl=function(){return this.el.classList.add("lr"),this.defaults.UI&&(this.UI=new LrUI(this)),this.file=document.createElement("input"),this.file.type="file",this.el.appendChild(this.file)},t.prototype._getBase64=function(){var e;return this.file.addEventListener("change",function(){return e(this.files[0]),this.value=""},!1),e=function(e){return function(n){var i,s,o,r,a,u;i=window.URL||window.webkitURL,s=e.defaults,a=e.results={},a.original={};for(r in n)u=n[r],"function"!=typeof u&&(a.original[r]=u);return a.blob=i.createObjectURL(n),e.change(a),e.defaults.UI&&(e.setImg(a.blob),e.UI.setWait()),o=new Image,o.src=a.blob,o.onload=function(){var n,i,r,u,l,c,h,p,f,d,y,g;if(p=o.width/o.height,g=s.rWidth||o.width,c=g/p,i=document.createElement("canvas"),i.width=g,i.height=c,r=i.getContext("2d"),r.drawImage(o,0,0,g,c),y=navigator.userAgent,n=null,y.match(/iphone/i))try{h=new MegaPixImage(o),h.render(i,{maxWidth:g,maxHeight:c,quality:s.quality}),n=i.toDataURL("image/jpeg",s.quality)}catch(m){u=m,alert("未引用mobile补丁，无法生成图片。")}else if(y.match(/Android/i))try{l=new JPEGEncoder,n=l.encode(r.getImageData(0,0,g,c),100*s.quality)}catch(m){u=m,alert("未引用mobile补丁，无法生成图片。")}else n=i.toDataURL("image/jpeg",s.quality);return a.base64=n,a.base64Clean=n.substr(n.indexOf(",")+1),t.prototype.success!==e.success?(d=e,f=function(){function t(){}return t.prototype.stop=function(){return d.setStop.call(d)},t}(),e.success((new f).stop,a)):void 0}}}(this)},t.prototype._init=function(){return this._initStyle(),this._createEl(),this._getBase64()},t}(),window.LocalResize=t}).call(this);
(function(){!function(){var e;return e=angular.module("localResizeIMG",[]),e.directive("lRImg",function(){return{restrict:"E",scope:{ngModel:"=",change:"=",success:"=",reset:"=",title:"@"},link:function(e,n,t){var i,r,u,c,o;return c=t.rwidth,u=t.quality,o=void 0!==t.readonly,u=t.quality,i=t.ui||t.UI,r=new LocalResize(n[0],{rWidth:c,quality:u,readonly:o,quality:u,UI:i}),e.$watch("title",function(e){return r.UI.setTitle(e)}),r.change(function(n){return"function"==typeof e.change?e.change(n):void 0}).success(function(n,t){return e.$apply(function(){return e.ngModel=t}),"function"==typeof e.success?e.success(n,t):void 0}).reset=function(){return e.$apply(function(){return e.ngModel={}}),r.UI.reset(),"function"==typeof e.reset&&e.reset(),r},e.$watch("ngModel",function(e){return(null!=e?e.imgUrl:void 0)?o?r.setImgOnly(e.imgUrl):r.setImg(e.imgUrl):void 0})}}})}()}).call(this);